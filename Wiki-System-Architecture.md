# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

æœ¬é¡µé¢è¯¦ç»†ä»‹ç»åŸºäºAlistçš„æ–‡ä»¶æ‰˜ç®¡ç³»ç»Ÿçš„æŠ€æœ¯æ¶æ„ã€è®¾è®¡æ¨¡å¼å’Œæ ¸å¿ƒç»„ä»¶ã€‚

## ğŸ“‹ ç›®å½•

- [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [æ¶æ„å±‚æ¬¡](#æ¶æ„å±‚æ¬¡)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [è®¾è®¡æ¨¡å¼](#è®¾è®¡æ¨¡å¼)
- [æ•°æ®æµå‘](#æ•°æ®æµå‘)
- [å®‰å…¨æ¶æ„](#å®‰å…¨æ¶æ„)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

---

## ğŸ›ï¸ æ•´ä½“æ¶æ„

ç³»ç»Ÿé‡‡ç”¨ç»å…¸çš„**ä¸‰å±‚B/Sæ¶æ„**ï¼Œç»“åˆç°ä»£Webå¼€å‘æŠ€æœ¯æ ˆï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œé«˜æ€§èƒ½ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸŒ è¡¨ç°å±‚ (Presentation Layer)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“± Webæµè§ˆå™¨  â”‚  ğŸ“„ JSPé¡µé¢  â”‚  ğŸ¨ Bootstrap UI  â”‚  âš¡ AJAX  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†•ï¸ HTTP/HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ® æ§åˆ¶å±‚ (Control Layer)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”§ Servletå®¹å™¨  â”‚  ğŸ“¡ Controller  â”‚  ğŸ”’ Filter  â”‚  ğŸ“Š JSON  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†•ï¸ æ–¹æ³•è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ğŸ’¼ ä¸šåŠ¡é€»è¾‘å±‚ (Business Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”§ Service  â”‚  ğŸ› ï¸ Utils  â”‚  ğŸ“¦ Model  â”‚  ğŸ” Security  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†•ï¸ æ•°æ®è®¿é—®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ğŸ—„ï¸ æ•°æ®è®¿é—®å±‚ (Data Access Layer)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š DAO  â”‚  ğŸ”— DBUtil  â”‚  ğŸŠ è¿æ¥æ±   â”‚  ğŸ“‹ SQL  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†•ï¸ JDBC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ’¾ æ•°æ®å­˜å‚¨å±‚ (Storage Layer)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ—ƒï¸ MySQLæ•°æ®åº“  â”‚  â˜ï¸ Alistäº‘å­˜å‚¨  â”‚  ğŸ“ æ–‡ä»¶ç³»ç»Ÿ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | è¯´æ˜ |
|------|------|------|------|
| **Java** | 1.8+ | æ ¸å¿ƒå¼€å‘è¯­è¨€ | æä¾›ç¨³å®šçš„è¿è¡Œç¯å¢ƒå’Œä¸°å¯Œçš„ç”Ÿæ€ |
| **Servlet** | 4.0 | Webå®¹å™¨æŠ€æœ¯ | å¤„ç†HTTPè¯·æ±‚å’Œå“åº” |
| **JSP** | 2.3 | é¡µé¢æ¨¡æ¿æŠ€æœ¯ | åŠ¨æ€ç”ŸæˆHTMLé¡µé¢ |
| **JSTL** | 1.2 | æ ‡ç­¾åº“ | ç®€åŒ–JSPé¡µé¢å¼€å‘ |
| **MySQL** | 8.0 | å…³ç³»å‹æ•°æ®åº“ | å­˜å‚¨ç”¨æˆ·å’Œæ–‡ä»¶å…ƒæ•°æ® |
| **C3P0** | 0.9.5 | æ•°æ®åº“è¿æ¥æ±  | ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Œæé«˜æ€§èƒ½ |
| **OkHttp** | 4.10.0 | HTTPå®¢æˆ·ç«¯ | ä¸Alist APIé€šä¿¡ |
| **Jackson** | 2.15.2 | JSONå¤„ç† | åºåˆ—åŒ–å’Œååºåˆ—åŒ–JSONæ•°æ® |
| **Commons FileUpload** | 1.4 | æ–‡ä»¶ä¸Šä¼  | å¤„ç†multipart/form-dataè¯·æ±‚ |

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | è¯´æ˜ |
|------|------|------|------|
| **HTML5** | - | é¡µé¢ç»“æ„ | ç°ä»£Webæ ‡å‡† |
| **CSS3** | - | æ ·å¼è®¾è®¡ | å“åº”å¼å¸ƒå±€å’ŒåŠ¨ç”»æ•ˆæœ |
| **JavaScript** | ES6+ | å‰ç«¯é€»è¾‘ | ç”¨æˆ·äº¤äº’å’ŒåŠ¨æ€æ•ˆæœ |
| **jQuery** | 3.6.0 | DOMæ“ä½œ | ç®€åŒ–JavaScriptå¼€å‘ |
| **Bootstrap** | 5.1.3 | UIæ¡†æ¶ | å“åº”å¼ç»„ä»¶å’Œæ ·å¼ |
| **AJAX** | - | å¼‚æ­¥é€šä¿¡ | æ— åˆ·æ–°æ•°æ®äº¤äº’ |

### å¤–éƒ¨æœåŠ¡

| æœåŠ¡ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| **Alist** | äº‘å­˜å‚¨ç®¡ç† | ç»Ÿä¸€ç®¡ç†å¤šç§äº‘å­˜å‚¨æœåŠ¡ |
| **äº‘å­˜å‚¨** | æ–‡ä»¶å­˜å‚¨ | é˜¿é‡Œäº‘OSSã€è…¾è®¯äº‘COSç­‰ |
| **Tomcat** | WebæœåŠ¡å™¨ | éƒ¨ç½²å’Œè¿è¡ŒWebåº”ç”¨ |

## ğŸ—ï¸ æ¶æ„å±‚æ¬¡

### 1ï¸âƒ£ è¡¨ç°å±‚ (Presentation Layer)

**èŒè´£**ï¼šç”¨æˆ·ç•Œé¢å±•ç¤ºå’Œç”¨æˆ·äº¤äº’å¤„ç†

```
è¡¨ç°å±‚ç»„ä»¶
â”œâ”€â”€ ğŸ“„ JSPé¡µé¢
â”‚   â”œâ”€â”€ index.jsp          # é¦–é¡µ
â”‚   â”œâ”€â”€ login.jsp          # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ dashboard.jsp      # ä»ªè¡¨æ¿
â”‚   â”œâ”€â”€ upload.jsp         # æ–‡ä»¶ä¸Šä¼ 
â”‚   â”œâ”€â”€ files.jsp          # æ–‡ä»¶ç®¡ç†
â”‚   â””â”€â”€ profile.jsp        # ç”¨æˆ·èµ„æ–™
â”œâ”€â”€ ğŸ¨ é™æ€èµ„æº
â”‚   â”œâ”€â”€ CSSæ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ JavaScriptè„šæœ¬
â”‚   â””â”€â”€ å›¾ç‰‡èµ„æº
â””â”€â”€ ğŸ”§ å‰ç«¯æ¡†æ¶
    â”œâ”€â”€ Bootstrap UIç»„ä»¶
    â”œâ”€â”€ jQueryåº“
    â””â”€â”€ AJAXå¼‚æ­¥é€šä¿¡
```

**ç‰¹ç‚¹**ï¼š
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå¤šè®¾å¤‡è®¿é—®
- ğŸ¨ ç°ä»£åŒ–UIç•Œé¢ï¼Œç”¨æˆ·ä½“éªŒå‹å¥½
- âš¡ AJAXå¼‚æ­¥äº¤äº’ï¼Œé¡µé¢æ— åˆ·æ–°æ›´æ–°
- ğŸ”’ å‰ç«¯æ•°æ®éªŒè¯ï¼Œæé«˜å®‰å…¨æ€§

### 2ï¸âƒ£ æ§åˆ¶å±‚ (Control Layer)

**èŒè´£**ï¼šå¤„ç†HTTPè¯·æ±‚ï¼Œåè°ƒä¸šåŠ¡é€»è¾‘å’Œè§†å›¾æ¸²æŸ“

```
æ§åˆ¶å±‚ç»„ä»¶
â”œâ”€â”€ ğŸ® Servletæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ LoginServlet       # ç”¨æˆ·ç™»å½•
â”‚   â”œâ”€â”€ LogoutServlet      # ç”¨æˆ·ç™»å‡º
â”‚   â”œâ”€â”€ UploadServlet      # æ–‡ä»¶ä¸Šä¼ 
â”‚   â”œâ”€â”€ FileQuery          # æ–‡ä»¶æŸ¥è¯¢
â”‚   â”œâ”€â”€ MediaFileQuery     # åª’ä½“æ–‡ä»¶æŸ¥è¯¢
â”‚   â””â”€â”€ StorageStats       # å­˜å‚¨ç»Ÿè®¡
â”œâ”€â”€ ğŸ”’ è¿‡æ»¤å™¨ (Filter)
â”‚   â”œâ”€â”€ å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ ç™»å½•éªŒè¯è¿‡æ»¤å™¨
â”‚   â””â”€â”€ è·¨åŸŸè¯·æ±‚è¿‡æ»¤å™¨
â””â”€â”€ ğŸ“¡ è¯·æ±‚å¤„ç†
    â”œâ”€â”€ å‚æ•°éªŒè¯
    â”œâ”€â”€ å¼‚å¸¸å¤„ç†
    â””â”€â”€ å“åº”æ ¼å¼åŒ–
```

**è®¾è®¡åŸåˆ™**ï¼š
- ğŸ¯ å•ä¸€èŒè´£ï¼šæ¯ä¸ªServletåªå¤„ç†ç‰¹å®šåŠŸèƒ½
- ğŸ”„ ç»Ÿä¸€å¤„ç†ï¼šç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å’Œå“åº”æ ¼å¼
- ğŸ“Š JSONé€šä¿¡ï¼šå‰åç«¯é‡‡ç”¨JSONæ ¼å¼äº¤äº’
- ğŸ”’ å®‰å…¨éªŒè¯ï¼šç»Ÿä¸€çš„æƒé™éªŒè¯æœºåˆ¶

### 3ï¸âƒ£ ä¸šåŠ¡é€»è¾‘å±‚ (Business Layer)

**èŒè´£**ï¼šå®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†ä¸šåŠ¡è§„åˆ™å’Œæ•°æ®è½¬æ¢

```
ä¸šåŠ¡é€»è¾‘å±‚ç»„ä»¶
â”œâ”€â”€ ğŸ’¼ ServiceæœåŠ¡
â”‚   â”œâ”€â”€ UserService        # ç”¨æˆ·ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ FileService        # æ–‡ä»¶ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ UploadService      # æ–‡ä»¶ä¸Šä¼ æœåŠ¡
â”‚   â””â”€â”€ AlistService       # Alisté›†æˆæœåŠ¡
â”œâ”€â”€ ğŸ“¦ Modelæ¨¡å‹
â”‚   â”œâ”€â”€ User.java          # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ MediaFile.java     # åª’ä½“æ–‡ä»¶æ¨¡å‹
â”‚   â””â”€â”€ StorageInfo.java   # å­˜å‚¨ä¿¡æ¯æ¨¡å‹
â”œâ”€â”€ ğŸ› ï¸ Utilså·¥å…·
â”‚   â”œâ”€â”€ AlistUtils         # Alistå·¥å…·ç±»
â”‚   â”œâ”€â”€ FileTypeMapper     # æ–‡ä»¶ç±»å‹æ˜ å°„
â”‚   â”œâ”€â”€ TokenManager       # Tokenç®¡ç†
â”‚   â””â”€â”€ AlistUploader      # æ–‡ä»¶ä¸Šä¼ å·¥å…·
â””â”€â”€ ğŸ” Securityå®‰å…¨
    â”œâ”€â”€ æƒé™éªŒè¯
    â”œâ”€â”€ æ•°æ®åŠ å¯†
    â””â”€â”€ è¾“å…¥éªŒè¯
```

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- ğŸ”§ æ¨¡å—åŒ–è®¾è®¡ï¼šåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºç»´æŠ¤
- ğŸ”„ äº‹åŠ¡ç®¡ç†ï¼šç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- ğŸ›¡ï¸ å®‰å…¨æ§åˆ¶ï¼šå®Œå–„çš„æƒé™å’Œå®‰å…¨æœºåˆ¶
- ğŸ”Œ æ¥å£æŠ½è±¡ï¼šä¾¿äºæ‰©å±•å’Œæµ‹è¯•

### 4ï¸âƒ£ æ•°æ®è®¿é—®å±‚ (Data Access Layer)

**èŒè´£**ï¼šå°è£…æ•°æ®åº“æ“ä½œï¼Œæä¾›æ•°æ®æŒä¹…åŒ–æœåŠ¡

```
æ•°æ®è®¿é—®å±‚ç»„ä»¶
â”œâ”€â”€ ğŸ“Š DAOå¯¹è±¡
â”‚   â”œâ”€â”€ UserDAO            # ç”¨æˆ·æ•°æ®è®¿é—®
â”‚   â”œâ”€â”€ MediaFileDAO       # åª’ä½“æ–‡ä»¶æ•°æ®è®¿é—®
â”‚   â””â”€â”€ LogDAO             # æ—¥å¿—æ•°æ®è®¿é—®
â”œâ”€â”€ ğŸ”— æ•°æ®åº“å·¥å…·
â”‚   â”œâ”€â”€ DBUtil             # æ•°æ®åº“è¿æ¥å·¥å…·
â”‚   â”œâ”€â”€ ConnectionPool     # è¿æ¥æ± ç®¡ç†
â”‚   â””â”€â”€ SQLBuilder         # SQLæ„å»ºå™¨
â””â”€â”€ ğŸ“‹ æ•°æ®æ“ä½œ
    â”œâ”€â”€ CRUDæ“ä½œ
    â”œâ”€â”€ äº‹åŠ¡ç®¡ç†
    â””â”€â”€ æ‰¹é‡æ“ä½œ
```

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- ğŸŠ è¿æ¥æ± æŠ€æœ¯ï¼šC3P0è¿æ¥æ± æé«˜æ€§èƒ½
- ğŸ”’ SQLé˜²æ³¨å…¥ï¼šé¢„ç¼–è¯‘è¯­å¥é˜²èŒƒSQLæ³¨å…¥
- ğŸ“Š ORMæ˜ å°„ï¼šå¯¹è±¡å…³ç³»æ˜ å°„ç®€åŒ–å¼€å‘
- ğŸ”„ äº‹åŠ¡æ”¯æŒï¼šç¡®ä¿æ•°æ®æ“ä½œçš„åŸå­æ€§

## ğŸ§© æ ¸å¿ƒç»„ä»¶

### ğŸ” è®¤è¯ä¸æˆæƒç»„ä»¶

```java
// ç”¨æˆ·è®¤è¯æµç¨‹
User Authentication Flow:
1. ç”¨æˆ·æäº¤ç™»å½•ä¿¡æ¯
2. LoginServletéªŒè¯ç”¨æˆ·åå¯†ç 
3. åˆ›å»ºSessionå­˜å‚¨ç”¨æˆ·ä¿¡æ¯
4. è¿”å›ç™»å½•ç»“æœ

// æƒé™æ§åˆ¶
Authorization Levels:
- æ™®é€šç”¨æˆ· (is_regular = 1): åŸºæœ¬æ–‡ä»¶æ“ä½œ
- ç¼–è¾‘è€… (is_editor = 1): é«˜çº§æ–‡ä»¶ç®¡ç†
- ç®¡ç†å‘˜ (is_admin = 1): ç³»ç»Ÿç®¡ç†æƒé™
```

### ğŸ“¤ æ–‡ä»¶ä¸Šä¼ ç»„ä»¶

```java
// æ–‡ä»¶ä¸Šä¼ å¤„ç†æµç¨‹
File Upload Process:
1. å‰ç«¯é€‰æ‹©æ–‡ä»¶ â†’ MultipartConfigæ¥æ”¶
2. ä¸´æ—¶å­˜å‚¨ â†’ æ–‡ä»¶éªŒè¯å’Œå¤„ç†
3. Alist APIä¸Šä¼  â†’ äº‘ç«¯å­˜å‚¨
4. æ•°æ®åº“è®°å½• â†’ å…ƒæ•°æ®æŒä¹…åŒ–
5. æ¸…ç†ä¸´æ—¶æ–‡ä»¶ â†’ è¿”å›ç»“æœ

// æ ¸å¿ƒç»„ä»¶
UploadServlet + AlistUploader + MediaFileDAO
```

### â˜ï¸ Alisté›†æˆç»„ä»¶

```java
// Alist APIé›†æˆæ¶æ„
Alist Integration:
â”œâ”€â”€ TokenManager      # Tokenè·å–å’Œç®¡ç†
â”œâ”€â”€ AlistUploader     # æ–‡ä»¶ä¸Šä¼ åˆ°Alist
â”œâ”€â”€ AlistUtils        # Alist APIé€šç”¨æ–¹æ³•
â”œâ”€â”€ AlistRefresher    # ç›®å½•åˆ·æ–°å’ŒåŒæ­¥
â””â”€â”€ AlistTest         # APIè¿æ¥æµ‹è¯•

// APIè°ƒç”¨æµç¨‹
1. è·å–Token â†’ 2. ä¸Šä¼ æ–‡ä»¶ â†’ 3. åˆ·æ–°ç›®å½• â†’ 4. è¿”å›ç»“æœ
```

### ğŸ—„ï¸ æ•°æ®åº“è¿æ¥ç»„ä»¶

```java
// æ•°æ®åº“è¿æ¥æ± é…ç½®
C3P0 Configuration:
- initialPoolSize: 5     # åˆå§‹è¿æ¥æ•°
- maxPoolSize: 20        # æœ€å¤§è¿æ¥æ•°
- checkoutTimeout: 3000  # è·å–è¿æ¥è¶…æ—¶
- maxIdleTime: 1800      # æœ€å¤§ç©ºé—²æ—¶é—´

// è¿æ¥ç®¡ç†
DBUtil.getConnection() â†’ è·å–è¿æ¥
DBUtil.close() â†’ é‡Šæ”¾èµ„æº
```

## ğŸ¨ è®¾è®¡æ¨¡å¼

### 1. MVCæ¨¡å¼ (Model-View-Controller)

```
ğŸ® Controller (Servlet)
    â†•ï¸ æ§åˆ¶æµç¨‹
ğŸ“¦ Model (JavaBean)
    â†•ï¸ æ•°æ®ä¼ é€’  
ğŸ“„ View (JSP)
```

**ä¼˜åŠ¿**ï¼š
- ğŸ”„ åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§
- ğŸ”§ æ¨¡å—åŒ–å¼€å‘ï¼Œä¾¿äºå›¢é˜Ÿåä½œ
- ğŸ§ª ä¾¿äºå•å…ƒæµ‹è¯•å’Œè°ƒè¯•

### 2. DAOæ¨¡å¼ (Data Access Object)

```java
// DAOæ¥å£å®šä¹‰
public interface MediaFileDAO {
    void save(MediaFile mediaFile);
    MediaFile findById(int id);
    List<MediaFile> findByUserId(int userId);
    void update(MediaFile mediaFile);
    void delete(int id);
}

// å®ç°ç±»
public class MediaFileDAOImpl implements MediaFileDAO {
    // å…·ä½“çš„æ•°æ®åº“æ“ä½œå®ç°
}
```

**ä¼˜åŠ¿**ï¼š
- ğŸ”’ å°è£…æ•°æ®è®¿é—®é€»è¾‘
- ğŸ”„ ä¾¿äºåˆ‡æ¢æ•°æ®æº
- ğŸ§ª ä¾¿äºå•å…ƒæµ‹è¯•

### 3. å•ä¾‹æ¨¡å¼ (Singleton)

```java
// æ•°æ®åº“è¿æ¥æ± å•ä¾‹
public class DBUtil {
    private static final ComboPooledDataSource dataSource = new ComboPooledDataSource();
    
    // ç§æœ‰æ„é€ å‡½æ•°
    private DBUtil() {}
    
    // è·å–è¿æ¥
    public static Connection getConnection() throws SQLException {
        return dataSource.getConnection();
    }
}
```

**ä¼˜åŠ¿**ï¼š
- ğŸ’¾ èŠ‚çœç³»ç»Ÿèµ„æº
- ğŸ”’ ç¡®ä¿å…¨å±€å”¯ä¸€å®ä¾‹
- âš¡ æé«˜æ€§èƒ½

### 4. å·¥å‚æ¨¡å¼ (Factory)

```java
// æ–‡ä»¶ç±»å‹å·¥å‚
public class FileTypeMapper {
    public static String mapFileType(String fileName) {
        String extension = getFileExtension(fileName);
        switch (extension.toLowerCase()) {
            case "jpg": case "png": case "gif":
                return "image";
            case "mp4": case "avi": case "mov":
                return "video";
            case "mp3": case "wav": case "flac":
                return "audio";
            default:
                return "other";
        }
    }
}
```

## ğŸ”„ æ•°æ®æµå‘

### ğŸ“¤ æ–‡ä»¶ä¸Šä¼ æ•°æ®æµ

```
1. ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
   â†“ multipart/form-data
2. UploadServletæ¥æ”¶
   â†“ æ–‡ä»¶å¤„ç†
3. ä¸´æ—¶å­˜å‚¨éªŒè¯
   â†“ APIè°ƒç”¨
4. AlistUploaderä¸Šä¼ 
   â†“ HTTP PUT
5. Alistäº‘å­˜å‚¨
   â†“ å“åº”ç¡®è®¤
6. MediaFileDAOä¿å­˜
   â†“ SQL INSERT
7. MySQLæ•°æ®åº“
   â†“ ç»“æœè¿”å›
8. JSONå“åº”ç”¨æˆ·
```

### ğŸ“¥ æ–‡ä»¶æŸ¥è¯¢æ•°æ®æµ

```
1. ç”¨æˆ·å‘èµ·æŸ¥è¯¢
   â†“ AJAXè¯·æ±‚
2. FileQueryå¤„ç†
   â†“ å‚æ•°è§£æ
3. MediaFileDAOæŸ¥è¯¢
   â†“ SQL SELECT
4. MySQLæ•°æ®åº“
   â†“ ç»“æœé›†è¿”å›
5. æ•°æ®è½¬æ¢å¤„ç†
   â†“ JSONåºåˆ—åŒ–
6. å“åº”è¿”å›å‰ç«¯
   â†“ DOMæ›´æ–°
7. é¡µé¢å±•ç¤ºç»“æœ
```

### ğŸ‘¤ ç”¨æˆ·è®¤è¯æ•°æ®æµ

```
1. ç”¨æˆ·æäº¤ç™»å½•
   â†“ POSTè¯·æ±‚
2. LoginServletéªŒè¯
   â†“ å¯†ç æ ¡éªŒ
3. æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·
   â†“ æƒé™æ£€æŸ¥
4. åˆ›å»ºSession
   â†“ ç”¨æˆ·ä¿¡æ¯å­˜å‚¨
5. è¿”å›ç™»å½•ç»“æœ
   â†“ é¡µé¢é‡å®šå‘
6. è¿›å…¥ç³»ç»Ÿä¸»é¡µ
```

## ğŸ”’ å®‰å…¨æ¶æ„

### ğŸ›¡ï¸ å¤šå±‚å®‰å…¨é˜²æŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ğŸŒ ç½‘ç»œå±‚å®‰å…¨                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTTPSåŠ å¯†  â”‚  é˜²ç«å¢™  â”‚  DDoSé˜²æŠ¤   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ğŸ® åº”ç”¨å±‚å®‰å…¨                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èº«ä»½è®¤è¯  â”‚  æƒé™æ§åˆ¶  â”‚  ä¼šè¯ç®¡ç†    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ğŸ’¾ æ•°æ®å±‚å®‰å…¨                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SQLé˜²æ³¨å…¥  â”‚  æ•°æ®åŠ å¯†  â”‚  è®¿é—®æ§åˆ¶   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ” å®‰å…¨æœºåˆ¶è¯¦è§£

#### 1. èº«ä»½è®¤è¯å®‰å…¨

```java
// Sessionç®¡ç†
HttpSession session = request.getSession();
User user = (User) session.getAttribute("userInfo");
if (user == null) {
    // é‡å®šå‘åˆ°ç™»å½•é¡µé¢
    response.sendRedirect("login.jsp");
    return;
}
```

#### 2. SQLæ³¨å…¥é˜²æŠ¤

```java
// ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥
String sql = "SELECT * FROM users WHERE username = ? AND password = ?";
PreparedStatement stmt = conn.prepareStatement(sql);
stmt.setString(1, username);
stmt.setString(2, password);
```

#### 3. XSSæ”»å‡»é˜²æŠ¤

```java
// è¾“å…¥éªŒè¯å’Œè½¬ä¹‰
public static String escapeHtml(String input) {
    return input.replace("<", "&lt;")
                .replace(">", "&gt;")
                .replace("&", "&amp;");
}
```

#### 4. æ–‡ä»¶ä¸Šä¼ å®‰å…¨

```java
// æ–‡ä»¶ç±»å‹éªŒè¯
private boolean isValidFileType(String fileName) {
    String[] allowedTypes = {".jpg", ".png", ".gif", ".pdf", ".doc"};
    String extension = getFileExtension(fileName);
    return Arrays.asList(allowedTypes).contains(extension.toLowerCase());
}
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ğŸŠ æ•°æ®åº“ä¼˜åŒ–

```sql
-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_user_id ON media_files(user_id);
CREATE INDEX idx_filename ON media_files(filename);
CREATE INDEX idx_upload_time ON media_files(uploaded_at);

-- æŸ¥è¯¢ä¼˜åŒ–
SELECT * FROM media_files 
WHERE user_id = ? 
ORDER BY uploaded_at DESC 
LIMIT 20;
```

### ğŸ”— è¿æ¥æ± ä¼˜åŒ–

```java
// C3P0è¿æ¥æ± é…ç½®
dataSource.setInitialPoolSize(5);        // åˆå§‹è¿æ¥æ•°
dataSource.setMaxPoolSize(20);           // æœ€å¤§è¿æ¥æ•°
dataSource.setMinPoolSize(3);            // æœ€å°è¿æ¥æ•°
dataSource.setAcquireIncrement(2);       // è¿æ¥å¢é•¿æ­¥é•¿
dataSource.setMaxIdleTime(1800);         // æœ€å¤§ç©ºé—²æ—¶é—´
dataSource.setCheckoutTimeout(3000);     // è·å–è¿æ¥è¶…æ—¶
```

### ğŸ“¦ ç¼“å­˜ç­–ç•¥

```java
// æ–‡ä»¶ä¿¡æ¯ç¼“å­˜
public class FileCache {
    private static final Map<String, MediaFile> cache = new ConcurrentHashMap<>();
    
    public static MediaFile get(String key) {
        return cache.get(key);
    }
    
    public static void put(String key, MediaFile file) {
        cache.put(key, file);
    }
}
```

### ğŸ”„ å¼‚æ­¥å¤„ç†

```java
// å¼‚æ­¥æ–‡ä»¶ä¸Šä¼ 
@WebServlet(value = "/upload", asyncSupported = true)
public class AsyncUploadServlet extends HttpServlet {
    
    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response) {
        AsyncContext asyncContext = request.startAsync();
        
        // å¼‚æ­¥å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        CompletableFuture.runAsync(() -> {
            try {
                // æ–‡ä»¶ä¸Šä¼ é€»è¾‘
                processFileUpload(request, response);
            } finally {
                asyncContext.complete();
            }
        });
    }
}
```

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### ğŸ“ˆ æ€§èƒ½ç›‘æ§

```java
// æ€§èƒ½ç›‘æ§åˆ‡é¢
public class PerformanceMonitor {
    
    public void monitorMethod(String methodName, long startTime) {
        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;
        
        if (duration > 1000) { // è¶…è¿‡1ç§’è®°å½•è­¦å‘Š
            logger.warn("Method {} took {} ms", methodName, duration);
        }
    }
}
```

### ğŸ“ æ—¥å¿—ç®¡ç†

```java
// ç»Ÿä¸€æ—¥å¿—è®°å½•
public class LogUtil {
    private static final Logger logger = LoggerFactory.getLogger(LogUtil.class);
    
    public static void logUserAction(String username, String action, String details) {
        logger.info("User: {}, Action: {}, Details: {}", username, action, details);
    }
    
    public static void logError(String operation, Exception e) {
        logger.error("Error in {}: {}", operation, e.getMessage(), e);
    }
}
```

---

## ğŸ”— ç›¸å…³é¡µé¢

- [é¦–é¡µ](Wiki-Home.md) - é¡¹ç›®æ¦‚è¿°å’Œæ–‡æ¡£å¯¼èˆª
- [é¡¹ç›®ç»“æ„](Wiki-Project-Structure.md) - è¯¦ç»†çš„é¡¹ç›®ç›®å½•ç»“æ„
- [APIæ–‡æ¡£](Wiki-API-Documentation.md) - ç³»ç»ŸAPIæ¥å£æ–‡æ¡£
- [éƒ¨ç½²æŒ‡å—](Wiki-Deployment-Guide.md) - ç³»ç»Ÿéƒ¨ç½²å’Œé…ç½®æŒ‡å—
- [å¼€å‘æŒ‡å—](Wiki-Development-Guide.md) - å¼€å‘ç¯å¢ƒæ­å»ºå’Œå¼€å‘è§„èŒƒ

---

*æœ€åæ›´æ–°æ—¶é—´ï¼š2024å¹´*