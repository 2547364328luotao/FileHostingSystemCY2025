# ğŸš€ éƒ¨ç½²æŒ‡å—

æœ¬é¡µé¢è¯¦ç»†ä»‹ç»åŸºäºAlistçš„æ–‡ä»¶æ‰˜ç®¡ç³»ç»Ÿçš„éƒ¨ç½²æ­¥éª¤ã€ç¯å¢ƒé…ç½®å’Œè¿ç»´ç®¡ç†ã€‚

## ğŸ“‹ ç›®å½•

- [éƒ¨ç½²æ¦‚è¿°](#éƒ¨ç½²æ¦‚è¿°)
- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
- [æ•°æ®åº“é…ç½®](#æ•°æ®åº“é…ç½®)
- [AlistæœåŠ¡é…ç½®](#alistæœåŠ¡é…ç½®)
- [åº”ç”¨éƒ¨ç½²](#åº”ç”¨éƒ¨ç½²)
- [é…ç½®æ–‡ä»¶](#é…ç½®æ–‡ä»¶)
- [å¯åŠ¨ä¸éªŒè¯](#å¯åŠ¨ä¸éªŒè¯)
- [è¿ç»´ç®¡ç†](#è¿ç»´ç®¡ç†)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

---

## ğŸŒ éƒ¨ç½²æ¦‚è¿°

### éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸŒ è´Ÿè½½å‡è¡¡å±‚ (å¯é€‰)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Nginx/Apache  â”‚  SSLè¯ä¹¦  â”‚  åŸŸåè§£æ  â”‚  CDNåŠ é€Ÿ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†•ï¸ HTTP/HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ® åº”ç”¨æœåŠ¡å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tomcat 9.0+  â”‚  JVM 1.8+  â”‚  Webåº”ç”¨  â”‚  Sessionç®¡ç†  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†•ï¸ JDBC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ—„ï¸ æ•°æ®å­˜å‚¨å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MySQL 8.0+  â”‚  è¿æ¥æ±   â”‚  æ•°æ®å¤‡ä»½  â”‚  ä¸»ä»å¤åˆ¶  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†•ï¸ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â˜ï¸ æ–‡ä»¶å­˜å‚¨å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AlistæœåŠ¡  â”‚  äº‘å­˜å‚¨  â”‚  æœ¬åœ°å­˜å‚¨  â”‚  æ–‡ä»¶ç®¡ç†  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨ç½²æ¨¡å¼

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|------|----------|------|
| **å•æœºéƒ¨ç½²** | å¼€å‘æµ‹è¯•ã€å°å‹åº”ç”¨ | ç®€å•å¿«é€Ÿï¼Œèµ„æºå ç”¨å°‘ |
| **åˆ†å¸ƒå¼éƒ¨ç½²** | ç”Ÿäº§ç¯å¢ƒã€å¤§å‹åº”ç”¨ | é«˜å¯ç”¨ï¼Œå¯æ‰©å±•ï¼Œæ€§èƒ½å¥½ |
| **å®¹å™¨åŒ–éƒ¨ç½²** | äº‘åŸç”Ÿç¯å¢ƒ | æ˜“ç®¡ç†ï¼Œå¯ç§»æ¤ï¼Œè‡ªåŠ¨åŒ– |
| **é›†ç¾¤éƒ¨ç½²** | é«˜å¹¶å‘åœºæ™¯ | è´Ÿè½½å‡è¡¡ï¼Œæ•…éšœè½¬ç§» |

---

## ğŸ’» ç¯å¢ƒè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

#### æœ€å°é…ç½®

| ç»„ä»¶ | è¦æ±‚ |
|------|------|
| **CPU** | 2æ ¸å¿ƒ 2.0GHz |
| **å†…å­˜** | 4GB RAM |
| **å­˜å‚¨** | 50GB å¯ç”¨ç©ºé—´ |
| **ç½‘ç»œ** | 100Mbps å¸¦å®½ |

#### æ¨èé…ç½®

| ç»„ä»¶ | è¦æ±‚ |
|------|------|
| **CPU** | 4æ ¸å¿ƒ 2.5GHz+ |
| **å†…å­˜** | 8GB+ RAM |
| **å­˜å‚¨** | 200GB+ SSD |
| **ç½‘ç»œ** | 1Gbps å¸¦å®½ |

#### ç”Ÿäº§ç¯å¢ƒé…ç½®

| ç»„ä»¶ | è¦æ±‚ |
|------|------|
| **CPU** | 8æ ¸å¿ƒ 3.0GHz+ |
| **å†…å­˜** | 16GB+ RAM |
| **å­˜å‚¨** | 500GB+ NVMe SSD |
| **ç½‘ç»œ** | 10Gbps å¸¦å®½ |

### è½¯ä»¶è¦æ±‚

#### æ“ä½œç³»ç»Ÿ

| ç³»ç»Ÿ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| **Ubuntu** | 18.04+ | æ¨èLTSç‰ˆæœ¬ |
| **CentOS** | 7.0+ | ç¨³å®šå¯é  |
| **Windows Server** | 2016+ | ä¼ä¸šç¯å¢ƒ |
| **Docker** | 20.0+ | å®¹å™¨åŒ–éƒ¨ç½² |

#### è¿è¡Œç¯å¢ƒ

| è½¯ä»¶ | ç‰ˆæœ¬ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| **Java JDK** | 1.8+ | âœ… | åº”ç”¨è¿è¡Œç¯å¢ƒ |
| **Apache Tomcat** | 9.0+ | âœ… | WebæœåŠ¡å™¨ |
| **MySQL** | 8.0+ | âœ… | æ•°æ®åº“æœåŠ¡ |
| **Alist** | 3.25+ | âœ… | æ–‡ä»¶ç®¡ç†æœåŠ¡ |
| **Nginx** | 1.18+ | âŒ | åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰ |

---

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1ï¸âƒ£ Javaç¯å¢ƒå®‰è£…

#### Ubuntu/Debian

```bash
# æ›´æ–°åŒ…ç®¡ç†å™¨
sudo apt update

# å®‰è£…OpenJDK 8
sudo apt install openjdk-8-jdk

# éªŒè¯å®‰è£…
java -version
javac -version

# é…ç½®JAVA_HOME
echo 'export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64' >> ~/.bashrc
echo 'export PATH=$PATH:$JAVA_HOME/bin' >> ~/.bashrc
source ~/.bashrc
```

#### CentOS/RHEL

```bash
# å®‰è£…OpenJDK 8
sudo yum install java-1.8.0-openjdk java-1.8.0-openjdk-devel

# éªŒè¯å®‰è£…
java -version
javac -version

# é…ç½®JAVA_HOME
echo 'export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk' >> ~/.bashrc
echo 'export PATH=$PATH:$JAVA_HOME/bin' >> ~/.bashrc
source ~/.bashrc
```

#### Windows

```powershell
# ä¸‹è½½å¹¶å®‰è£…Oracle JDK 8æˆ–OpenJDK 8
# ä»å®˜ç½‘ä¸‹è½½ï¼šhttps://www.oracle.com/java/technologies/javase-jdk8-downloads.html

# é…ç½®ç¯å¢ƒå˜é‡
# JAVA_HOME: C:\Program Files\Java\jdk1.8.0_XXX
# PATH: %JAVA_HOME%\bin

# éªŒè¯å®‰è£…
java -version
javac -version
```

### 2ï¸âƒ£ Tomcatå®‰è£…é…ç½®

#### Linuxå®‰è£…

```bash
# ä¸‹è½½Tomcat 9
cd /opt
sudo wget https://downloads.apache.org/tomcat/tomcat-9/v9.0.75/bin/apache-tomcat-9.0.75.tar.gz

# è§£å‹
sudo tar -xzf apache-tomcat-9.0.75.tar.gz
sudo mv apache-tomcat-9.0.75 tomcat9

# åˆ›å»ºtomcatç”¨æˆ·
sudo useradd -r -m -U -d /opt/tomcat9 -s /bin/false tomcat

# è®¾ç½®æƒé™
sudo chown -R tomcat:tomcat /opt/tomcat9
sudo chmod +x /opt/tomcat9/bin/*.sh

# é…ç½®ç¯å¢ƒå˜é‡
sudo vim /opt/tomcat9/bin/setenv.sh
```

**setenv.shé…ç½®å†…å®¹**ï¼š

```bash
#!/bin/bash
export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
export CATALINA_HOME=/opt/tomcat9
export CATALINA_BASE=/opt/tomcat9
export CATALINA_OPTS="-Xms512m -Xmx2048m -XX:PermSize=256m -XX:MaxPermSize=512m"
export JAVA_OPTS="-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server"
```

#### åˆ›å»ºç³»ç»ŸæœåŠ¡

```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo vim /etc/systemd/system/tomcat.service
```

**tomcat.serviceå†…å®¹**ï¼š

```ini
[Unit]
Description=Apache Tomcat Web Application Container
After=network.target

[Service]
Type=forking

Environment=JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
Environment=CATALINA_PID=/opt/tomcat9/temp/tomcat.pid
Environment=CATALINA_HOME=/opt/tomcat9
Environment=CATALINA_BASE=/opt/tomcat9
Environment="CATALINA_OPTS=-Xms512M -Xmx2048M -server -XX:+UseParallelGC"
Environment="JAVA_OPTS=-Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djava.security.egd=file:/dev/./urandom"

ExecStart=/opt/tomcat9/bin/startup.sh
ExecStop=/opt/tomcat9/bin/shutdown.sh

User=tomcat
Group=tomcat
UMask=0007
RestartSec=10
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
# å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable tomcat
sudo systemctl start tomcat
sudo systemctl status tomcat
```

---

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### 1ï¸âƒ£ MySQLå®‰è£…

#### Ubuntu/Debian

```bash
# æ›´æ–°åŒ…ç®¡ç†å™¨
sudo apt update

# å®‰è£…MySQL Server
sudo apt install mysql-server

# å®‰å…¨é…ç½®
sudo mysql_secure_installation

# å¯åŠ¨MySQLæœåŠ¡
sudo systemctl start mysql
sudo systemctl enable mysql
```

#### CentOS/RHEL

```bash
# æ·»åŠ MySQLå®˜æ–¹ä»“åº“
sudo yum install https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm

# å®‰è£…MySQL Server
sudo yum install mysql-community-server

# å¯åŠ¨MySQLæœåŠ¡
sudo systemctl start mysqld
sudo systemctl enable mysqld

# è·å–ä¸´æ—¶å¯†ç 
sudo grep 'temporary password' /var/log/mysqld.log

# å®‰å…¨é…ç½®
sudo mysql_secure_installation
```

### 2ï¸âƒ£ æ•°æ®åº“åˆå§‹åŒ–

#### åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

```sql
-- ç™»å½•MySQL
mysql -u root -p

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE file_hosting_system DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·
CREATE USER 'filehost'@'localhost' IDENTIFIED BY 'StrongPassword123!';
CREATE USER 'filehost'@'%' IDENTIFIED BY 'StrongPassword123!';

-- æˆæƒ
GRANT ALL PRIVILEGES ON file_hosting_system.* TO 'filehost'@'localhost';
GRANT ALL PRIVILEGES ON file_hosting_system.* TO 'filehost'@'%';

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;

-- é€€å‡º
EXIT;
```

#### å¯¼å…¥æ•°æ®åº“ç»“æ„

```bash
# ä½¿ç”¨é¡¹ç›®æä¾›çš„SQLæ–‡ä»¶åˆå§‹åŒ–æ•°æ®åº“
mysql -u filehost -p file_hosting_system < database/init.sql

# æˆ–è€…æ‰‹åŠ¨åˆ›å»ºè¡¨ç»“æ„
mysql -u filehost -p file_hosting_system
```

**æ•°æ®åº“è¡¨ç»“æ„**ï¼š

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100),
    is_admin TINYINT(1) DEFAULT 0,
    is_editor TINYINT(1) DEFAULT 0,
    is_regular TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_username (username),
    INDEX idx_email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- åª’ä½“æ–‡ä»¶è¡¨
CREATE TABLE media_files (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    filename VARCHAR(255) NOT NULL,
    original_filename VARCHAR(255) NOT NULL,
    file_size BIGINT NOT NULL,
    file_type VARCHAR(50) NOT NULL,
    mime_type VARCHAR(100),
    file_path VARCHAR(500) NOT NULL,
    download_url VARCHAR(500),
    thumbnail_url VARCHAR(500),
    description TEXT,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_filename (filename),
    INDEX idx_file_type (file_type),
    INDEX idx_uploaded_at (uploaded_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ç³»ç»Ÿæ—¥å¿—è¡¨
CREATE TABLE system_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    action VARCHAR(100) NOT NULL,
    details TEXT,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_user_id (user_id),
    INDEX idx_action (action),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- æ’å…¥é»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·
INSERT INTO users (username, password, email, is_admin, is_editor, is_regular) 
VALUES ('admin', 'e10adc3949ba59abbe56e057f20f883e', 'admin@example.com', 1, 1, 1);
-- å¯†ç æ˜¯ 123456 çš„MD5å€¼
```

### 3ï¸âƒ£ æ•°æ®åº“ä¼˜åŒ–é…ç½®

#### MySQLé…ç½®æ–‡ä»¶ä¼˜åŒ–

```bash
# ç¼–è¾‘MySQLé…ç½®æ–‡ä»¶
sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf
# æˆ–è€…
sudo vim /etc/my.cnf
```

**ä¼˜åŒ–é…ç½®å†…å®¹**ï¼š

```ini
[mysqld]
# åŸºæœ¬è®¾ç½®
port = 3306
socket = /var/run/mysqld/mysqld.sock
basedir = /usr
datadir = /var/lib/mysql
tmpdir = /tmp
lc-messages-dir = /usr/share/mysql

# å­—ç¬¦é›†è®¾ç½®
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
init_connect = 'SET NAMES utf8mb4'

# è¿æ¥è®¾ç½®
max_connections = 200
max_connect_errors = 10000
connect_timeout = 60
wait_timeout = 28800
interactive_timeout = 28800

# ç¼“å­˜è®¾ç½®
innodb_buffer_pool_size = 1G
innodb_log_file_size = 256M
innodb_log_buffer_size = 16M
innodb_flush_log_at_trx_commit = 2

# æŸ¥è¯¢ç¼“å­˜
query_cache_type = 1
query_cache_size = 128M
query_cache_limit = 2M

# ä¸´æ—¶è¡¨è®¾ç½®
tmp_table_size = 64M
max_heap_table_size = 64M

# æ—¥å¿—è®¾ç½®
log_error = /var/log/mysql/error.log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

# äºŒè¿›åˆ¶æ—¥å¿—
log_bin = /var/log/mysql/mysql-bin.log
binlog_format = ROW
expire_logs_days = 7
max_binlog_size = 100M

[mysql]
default-character-set = utf8mb4

[client]
default-character-set = utf8mb4
```

```bash
# é‡å¯MySQLæœåŠ¡
sudo systemctl restart mysql
```

---

## â˜ï¸ AlistæœåŠ¡é…ç½®

### 1ï¸âƒ£ Alistå®‰è£…

#### ä½¿ç”¨ä¸€é”®è„šæœ¬å®‰è£…

```bash
# ä¸‹è½½å¹¶è¿è¡Œå®‰è£…è„šæœ¬
curl -fsSL "https://alist.nn.ci/v3.sh" | bash -s install

# æˆ–è€…ä½¿ç”¨å›½å†…é•œåƒ
curl -fsSL "https://alist.nn.ci/v3.sh" | bash -s install --mirror
```

#### æ‰‹åŠ¨å®‰è£…

```bash
# åˆ›å»ºalistç›®å½•
sudo mkdir -p /opt/alist
cd /opt/alist

# ä¸‹è½½æœ€æ–°ç‰ˆæœ¬
sudo wget https://github.com/alist-org/alist/releases/latest/download/alist-linux-amd64.tar.gz

# è§£å‹
sudo tar -zxvf alist-linux-amd64.tar.gz

# è®¾ç½®æƒé™
sudo chmod +x alist

# åˆ›å»ºalistç”¨æˆ·
sudo useradd -r -s /bin/false alist
sudo chown -R alist:alist /opt/alist
```

### 2ï¸âƒ£ Alisté…ç½®

#### åˆå§‹åŒ–é…ç½®

```bash
# åˆ‡æ¢åˆ°alistç›®å½•
cd /opt/alist

# ç”Ÿæˆé…ç½®æ–‡ä»¶
sudo -u alist ./alist admin

# å¯åŠ¨alistï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
sudo -u alist ./alist server
```

#### åˆ›å»ºç³»ç»ŸæœåŠ¡

```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo vim /etc/systemd/system/alist.service
```

**alist.serviceå†…å®¹**ï¼š

```ini
[Unit]
Description=Alist service
After=network.target

[Service]
Type=simple
WorkingDirectory=/opt/alist
ExecStart=/opt/alist/alist server
Restart=on-failure
User=alist
Group=alist

[Install]
WantedBy=multi-user.target
```

```bash
# å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable alist
sudo systemctl start alist
sudo systemctl status alist
```

### 3ï¸âƒ£ Alist Webé…ç½®

#### è®¿é—®ç®¡ç†ç•Œé¢

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://your-server-ip:5244`
2. ä½¿ç”¨ç”Ÿæˆçš„ç®¡ç†å‘˜è´¦å·ç™»å½•
3. è¿›å…¥ç®¡ç†ç•Œé¢è¿›è¡Œé…ç½®

#### æ·»åŠ å­˜å‚¨

**æœ¬åœ°å­˜å‚¨é…ç½®**ï¼š

```json
{
    "mount_path": "/files",
    "driver": "Local",
    "root_folder": "/opt/alist/data/files",
    "order": 0,
    "remark": "æœ¬åœ°æ–‡ä»¶å­˜å‚¨"
}
```

**é˜¿é‡Œäº‘ç›˜é…ç½®**ï¼š

```json
{
    "mount_path": "/aliyun",
    "driver": "AliyundriveOpen",
    "refresh_token": "your_refresh_token",
    "order": 1,
    "remark": "é˜¿é‡Œäº‘ç›˜å­˜å‚¨"
}
```

**è…¾è®¯äº‘COSé…ç½®**ï¼š

```json
{
    "mount_path": "/cos",
    "driver": "TencentCOS",
    "bucket": "your-bucket-name",
    "region": "ap-beijing",
    "secret_id": "your_secret_id",
    "secret_key": "your_secret_key",
    "order": 2,
    "remark": "è…¾è®¯äº‘COSå­˜å‚¨"
}
```

#### APIé…ç½®

åœ¨Alistç®¡ç†ç•Œé¢ä¸­é…ç½®APIè®¿é—®ï¼š

1. è¿›å…¥ **è®¾ç½®** â†’ **å…¶ä»–**
2. å¯ç”¨ **APIç­¾å**
3. è®¾ç½® **Tokenè¿‡æœŸæ—¶é—´**
4. è®°å½• **APIåœ°å€** å’Œ **Token**

---

## ğŸš€ åº”ç”¨éƒ¨ç½²

### 1ï¸âƒ£ é¡¹ç›®æ„å»º

#### ç¼–è¯‘é¡¹ç›®

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/FileHostingSystemCY

# å¦‚æœä½¿ç”¨Maven
mvn clean package

# å¦‚æœä½¿ç”¨Gradle
./gradlew build

# æ‰‹åŠ¨ç¼–è¯‘ï¼ˆå¦‚æœæ²¡æœ‰æ„å»ºå·¥å…·ï¼‰
javac -cp "lib/*" -d build/classes src/**/*.java
jar -cvf FileHostingSystemCY.war -C build/classes . -C src/main/webapp .
```

#### å‡†å¤‡WARæ–‡ä»¶

```bash
# å¤åˆ¶WARæ–‡ä»¶åˆ°Tomcat webappsç›®å½•
sudo cp target/FileHostingSystemCY.war /opt/tomcat9/webapps/

# æˆ–è€…åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /path/to/project/target/FileHostingSystemCY.war /opt/tomcat9/webapps/

# è®¾ç½®æƒé™
sudo chown tomcat:tomcat /opt/tomcat9/webapps/FileHostingSystemCY.war
```

### 2ï¸âƒ£ é…ç½®æ–‡ä»¶éƒ¨ç½²

#### æ•°æ®åº“é…ç½®

```bash
# åˆ›å»ºé…ç½®ç›®å½•
sudo mkdir -p /opt/tomcat9/conf/filehosting

# å¤åˆ¶é…ç½®æ–‡ä»¶
sudo cp src/main/resources/db.properties /opt/tomcat9/conf/filehosting/

# ç¼–è¾‘æ•°æ®åº“é…ç½®
sudo vim /opt/tomcat9/conf/filehosting/db.properties
```

**db.propertiesé…ç½®**ï¼š

```properties
# æ•°æ®åº“è¿æ¥é…ç½®
db.driver=com.mysql.cj.jdbc.Driver
db.url=jdbc:mysql://localhost:3306/file_hosting_system?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
db.username=filehost
db.password=StrongPassword123!

# è¿æ¥æ± é…ç½®
c3p0.initialPoolSize=5
c3p0.maxPoolSize=20
c3p0.minPoolSize=3
c3p0.acquireIncrement=2
c3p0.maxIdleTime=1800
c3p0.checkoutTimeout=3000
c3p0.testConnectionOnCheckout=true
c3p0.testConnectionOnCheckin=true
c3p0.idleConnectionTestPeriod=300
c3p0.preferredTestQuery=SELECT 1
```

#### Alisté…ç½®

```bash
# å¤åˆ¶Alisté…ç½®æ–‡ä»¶
sudo cp src/main/resources/alist.properties /opt/tomcat9/conf/filehosting/

# ç¼–è¾‘Alisté…ç½®
sudo vim /opt/tomcat9/conf/filehosting/alist.properties
```

**alist.propertiesé…ç½®**ï¼š

```properties
# AlistæœåŠ¡é…ç½®
alist.url=http://localhost:5244
alist.username=admin
alist.password=your_admin_password
alist.upload.path=/files
alist.api.timeout=30000

# æ–‡ä»¶ä¸Šä¼ é…ç½®
upload.max.size=104857600
# 100MB = 100 * 1024 * 1024
upload.allowed.types=jpg,jpeg,png,gif,bmp,pdf,doc,docx,xls,xlsx,ppt,pptx,txt,mp4,avi,mov,mp3,wav,flac
upload.temp.dir=/tmp/filehosting

# å®‰å…¨é…ç½®
security.session.timeout=3600
security.max.login.attempts=5
security.lockout.duration=1800
```

### 3ï¸âƒ£ ä¾èµ–åº“éƒ¨ç½²

#### å¤åˆ¶JARä¾èµ–

```bash
# å¤åˆ¶é¡¹ç›®ä¾èµ–åˆ°Tomcat libç›®å½•
sudo cp lib/*.jar /opt/tomcat9/lib/

# æˆ–è€…å¤åˆ¶åˆ°åº”ç”¨çš„WEB-INF/libç›®å½•
sudo cp lib/*.jar /opt/tomcat9/webapps/FileHostingSystemCY/WEB-INF/lib/

# è®¾ç½®æƒé™
sudo chown tomcat:tomcat /opt/tomcat9/lib/*.jar
```

#### å¿…éœ€çš„JARæ–‡ä»¶

```
lib/
â”œâ”€â”€ mysql-connector-java-8.0.33.jar     # MySQLé©±åŠ¨
â”œâ”€â”€ c3p0-0.9.5.5.jar                    # è¿æ¥æ± 
â”œâ”€â”€ mchange-commons-java-0.2.19.jar     # C3P0ä¾èµ–
â”œâ”€â”€ jackson-core-2.15.2.jar             # JSONå¤„ç†
â”œâ”€â”€ jackson-databind-2.15.2.jar         # JSONæ•°æ®ç»‘å®š
â”œâ”€â”€ jackson-annotations-2.15.2.jar      # JSONæ³¨è§£
â”œâ”€â”€ okhttp-4.10.0.jar                   # HTTPå®¢æˆ·ç«¯
â”œâ”€â”€ okio-3.0.0.jar                      # OkHttpä¾èµ–
â”œâ”€â”€ commons-fileupload-1.4.jar          # æ–‡ä»¶ä¸Šä¼ 
â”œâ”€â”€ commons-io-2.11.0.jar               # IOå·¥å…·
â”œâ”€â”€ jstl-1.2.jar                        # JSTLæ ‡ç­¾åº“
â””â”€â”€ standard-1.1.2.jar                  # JSTLå®ç°
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶

### 1ï¸âƒ£ Tomcaté…ç½®ä¼˜åŒ–

#### server.xmlé…ç½®

```bash
# ç¼–è¾‘Tomcatä¸»é…ç½®æ–‡ä»¶
sudo vim /opt/tomcat9/conf/server.xml
```

**å…³é”®é…ç½®é¡¹**ï¼š

```xml
<!-- è¿æ¥å™¨é…ç½® -->
<Connector port="8080" protocol="HTTP/1.1"
           connectionTimeout="20000"
           redirectPort="8443"
           maxThreads="200"
           minSpareThreads="10"
           maxSpareThreads="50"
           acceptCount="100"
           compression="on"
           compressionMinSize="2048"
           compressableMimeType="text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json"
           URIEncoding="UTF-8" />

<!-- è™šæ‹Ÿä¸»æœºé…ç½® -->
<Host name="localhost" appBase="webapps"
      unpackWARs="true" autoDeploy="true">
      
    <!-- åº”ç”¨ä¸Šä¸‹æ–‡é…ç½® -->
    <Context path="/FileHostingSystemCY" 
             docBase="FileHostingSystemCY"
             reloadable="false"
             crossContext="true">
             
        <!-- èµ„æºé…ç½® -->
        <Resource name="jdbc/FileHostingDB"
                  auth="Container"
                  type="javax.sql.DataSource"
                  driverClassName="com.mysql.cj.jdbc.Driver"
                  url="jdbc:mysql://localhost:3306/file_hosting_system?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai"
                  username="filehost"
                  password="StrongPassword123!"
                  maxTotal="20"
                  maxIdle="10"
                  maxWaitMillis="10000" />
    </Context>
</Host>
```

#### web.xmlé…ç½®

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
         http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <display-name>File Hosting System</display-name>
    <description>åŸºäºAlistçš„æ–‡ä»¶æ‰˜ç®¡ç³»ç»Ÿ</description>

    <!-- å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>CharacterEncodingFilter</filter-name>
        <filter-class>com.filehosting.filter.CharacterEncodingFilter</filter-class>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>UTF-8</param-value>
        </init-param>
    </filter>
    <filter-mapping>
        <filter-name>CharacterEncodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>

    <!-- ç™»å½•éªŒè¯è¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>LoginFilter</filter-name>
        <filter-class>com.filehosting.filter.LoginFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>LoginFilter</filter-name>
        <url-pattern>/dashboard.jsp</url-pattern>
        <url-pattern>/upload.jsp</url-pattern>
        <url-pattern>/files.jsp</url-pattern>
        <url-pattern>/profile.jsp</url-pattern>
        <url-pattern>/upload</url-pattern>
        <url-pattern>/files</url-pattern>
        <url-pattern>/media</url-pattern>
        <url-pattern>/storage/stats</url-pattern>
    </filter-mapping>

    <!-- Servleté…ç½® -->
    <servlet>
        <servlet-name>LoginServlet</servlet-name>
        <servlet-class>com.filehosting.servlet.LoginServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>LoginServlet</servlet-name>
        <url-pattern>/login</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>UploadServlet</servlet-name>
        <servlet-class>com.filehosting.servlet.UploadServlet</servlet-class>
        <multipart-config>
            <max-file-size>104857600</max-file-size>      <!-- 100MB -->
            <max-request-size>104857600</max-request-size> <!-- 100MB -->
            <file-size-threshold>1048576</file-size-threshold> <!-- 1MB -->
        </multipart-config>
    </servlet>
    <servlet-mapping>
        <servlet-name>UploadServlet</servlet-name>
        <url-pattern>/upload</url-pattern>
    </servlet-mapping>

    <!-- ä¼šè¯é…ç½® -->
    <session-config>
        <session-timeout>60</session-timeout> <!-- 60åˆ†é’Ÿ -->
        <cookie-config>
            <http-only>true</http-only>
            <secure>false</secure> <!-- ç”Ÿäº§ç¯å¢ƒè®¾ç½®ä¸ºtrue -->
        </cookie-config>
    </session-config>

    <!-- é”™è¯¯é¡µé¢é…ç½® -->
    <error-page>
        <error-code>404</error-code>
        <location>/error/404.jsp</location>
    </error-page>
    <error-page>
        <error-code>500</error-code>
        <location>/error/500.jsp</location>
    </error-page>

    <!-- æ¬¢è¿é¡µé¢ -->
    <welcome-file-list>
        <welcome-file>index.jsp</welcome-file>
    </welcome-file-list>

</web-app>
```

### 2ï¸âƒ£ æ—¥å¿—é…ç½®

#### logback.xmlé…ç½®

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    
    <!-- æ§åˆ¶å°è¾“å‡º -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <!-- æ–‡ä»¶è¾“å‡º -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>/opt/tomcat9/logs/filehosting.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>/opt/tomcat9/logs/filehosting.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>30</maxHistory>
            <totalSizeCap>1GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <!-- é”™è¯¯æ—¥å¿— -->
    <appender name="ERROR_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>/opt/tomcat9/logs/filehosting-error.log</file>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>/opt/tomcat9/logs/filehosting-error.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <!-- æ ¹æ—¥å¿—çº§åˆ« -->
    <root level="INFO">
        <appender-ref ref="CONSOLE" />
        <appender-ref ref="FILE" />
        <appender-ref ref="ERROR_FILE" />
    </root>
    
    <!-- ç‰¹å®šåŒ…çš„æ—¥å¿—çº§åˆ« -->
    <logger name="com.filehosting" level="DEBUG" />
    <logger name="org.springframework" level="WARN" />
    <logger name="com.mchange.v2.c3p0" level="WARN" />
    
</configuration>
```

---

## ğŸš€ å¯åŠ¨ä¸éªŒè¯

### 1ï¸âƒ£ æœåŠ¡å¯åŠ¨é¡ºåº

```bash
# 1. å¯åŠ¨MySQL
sudo systemctl start mysql
sudo systemctl status mysql

# 2. å¯åŠ¨Alist
sudo systemctl start alist
sudo systemctl status alist

# 3. å¯åŠ¨Tomcat
sudo systemctl start tomcat
sudo systemctl status tomcat

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep -E ':(3306|5244|8080)'
```

### 2ï¸âƒ£ åº”ç”¨éªŒè¯

#### åŸºæœ¬åŠŸèƒ½æµ‹è¯•

```bash
# 1. æ£€æŸ¥åº”ç”¨æ˜¯å¦éƒ¨ç½²æˆåŠŸ
curl -I http://localhost:8080/FileHostingSystemCY/

# 2. æµ‹è¯•ç™»å½•æ¥å£
curl -X POST http://localhost:8080/FileHostingSystemCY/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'

# 3. æµ‹è¯•Alistè¿æ¥
curl http://localhost:5244/api/public/settings

# 4. æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -u filehost -p file_hosting_system -e "SELECT COUNT(*) FROM users;"
```

#### Webç•Œé¢æµ‹è¯•

1. **è®¿é—®é¦–é¡µ**ï¼š`http://your-server-ip:8080/FileHostingSystemCY/`
2. **ç™»å½•æµ‹è¯•**ï¼šä½¿ç”¨é»˜è®¤è´¦å· `admin/123456`
3. **æ–‡ä»¶ä¸Šä¼ æµ‹è¯•**ï¼šä¸Šä¼ ä¸€ä¸ªå°æ–‡ä»¶éªŒè¯åŠŸèƒ½
4. **æ–‡ä»¶åˆ—è¡¨æµ‹è¯•**ï¼šæŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
5. **å­˜å‚¨ç»Ÿè®¡æµ‹è¯•**ï¼šæŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯æ˜¯å¦æ­£ç¡®

### 3ï¸âƒ£ æ€§èƒ½æµ‹è¯•

#### å‹åŠ›æµ‹è¯•

```bash
# ä½¿ç”¨Apache Benchè¿›è¡Œå‹åŠ›æµ‹è¯•
# å®‰è£…abå·¥å…·
sudo apt install apache2-utils  # Ubuntu/Debian
sudo yum install httpd-tools     # CentOS/RHEL

# æµ‹è¯•é¦–é¡µå“åº”
ab -n 1000 -c 10 http://localhost:8080/FileHostingSystemCY/

# æµ‹è¯•ç™»å½•æ¥å£
ab -n 100 -c 5 -p login.json -T application/json http://localhost:8080/FileHostingSystemCY/login

# login.jsonå†…å®¹
echo '{"username":"admin","password":"123456"}' > login.json
```

#### ç›‘æ§æŒ‡æ ‡

```bash
# ç›‘æ§ç³»ç»Ÿèµ„æº
top -p $(pgrep java)
free -h
df -h
iostat 1 5

# ç›‘æ§Tomcat JVM
jstat -gc $(pgrep java) 1s 10
jmap -histo $(pgrep java) | head -20

# ç›‘æ§æ•°æ®åº“
mysql -u root -p -e "SHOW PROCESSLIST;"
mysql -u root -p -e "SHOW STATUS LIKE 'Threads%';"
```

---

## ğŸ”§ è¿ç»´ç®¡ç†

### 1ï¸âƒ£ æ—¥å¸¸ç»´æŠ¤

#### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /opt/tomcat9/logs/catalina.out
tail -f /opt/tomcat9/logs/filehosting.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /opt/tomcat9/logs/filehosting-error.log

# æ—¥å¿—è½®è½¬é…ç½®
sudo vim /etc/logrotate.d/filehosting
```

**logrotateé…ç½®**ï¼š

```
/opt/tomcat9/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    copytruncate
    create 644 tomcat tomcat
}
```

#### æ•°æ®å¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
sudo vim /opt/scripts/backup.sh
```

**backup.shå†…å®¹**ï¼š

```bash
#!/bin/bash

# é…ç½®å˜é‡
BACKUP_DIR="/opt/backups"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="file_hosting_system"
DB_USER="filehost"
DB_PASS="StrongPassword123!"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# æ•°æ®åº“å¤‡ä»½
mysqldump -u$DB_USER -p$DB_PASS $DB_NAME > $BACKUP_DIR/db_backup_$DATE.sql

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip $BACKUP_DIR/db_backup_$DATE.sql

# åº”ç”¨æ–‡ä»¶å¤‡ä»½
tar -czf $BACKUP_DIR/app_backup_$DATE.tar.gz /opt/tomcat9/webapps/FileHostingSystemCY

# é…ç½®æ–‡ä»¶å¤‡ä»½
tar -czf $BACKUP_DIR/config_backup_$DATE.tar.gz /opt/tomcat9/conf/filehosting

# åˆ é™¤30å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*backup*" -mtime +30 -delete

echo "Backup completed: $DATE"
```

```bash
# è®¾ç½®æ‰§è¡Œæƒé™
sudo chmod +x /opt/scripts/backup.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰
0 2 * * * /opt/scripts/backup.sh >> /var/log/backup.log 2>&1
```

#### ç›‘æ§è„šæœ¬

```bash
# åˆ›å»ºç›‘æ§è„šæœ¬
sudo vim /opt/scripts/monitor.sh
```

**monitor.shå†…å®¹**ï¼š

```bash
#!/bin/bash

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
check_service() {
    local service=$1
    if systemctl is-active --quiet $service; then
        echo "âœ… $service is running"
    else
        echo "âŒ $service is not running"
        systemctl restart $service
        echo "ğŸ”„ Restarted $service"
    fi
}

# æ£€æŸ¥ç«¯å£
check_port() {
    local port=$1
    local service=$2
    if netstat -tlnp | grep -q ":$port "; then
        echo "âœ… Port $port ($service) is open"
    else
        echo "âŒ Port $port ($service) is not accessible"
    fi
}

# æ£€æŸ¥ç£ç›˜ç©ºé—´
check_disk() {
    local usage=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
    if [ $usage -gt 80 ]; then
        echo "âš ï¸ Disk usage is ${usage}% - Consider cleanup"
    else
        echo "âœ… Disk usage is ${usage}% - OK"
    fi
}

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
check_memory() {
    local usage=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
    if [ $usage -gt 80 ]; then
        echo "âš ï¸ Memory usage is ${usage}% - High"
    else
        echo "âœ… Memory usage is ${usage}% - OK"
    fi
}

echo "=== System Monitor Report $(date) ==="
check_service mysql
check_service alist
check_service tomcat
check_port 3306 MySQL
check_port 5244 Alist
check_port 8080 Tomcat
check_disk
check_memory
echo "==========================================="
```

```bash
# è®¾ç½®æ‰§è¡Œæƒé™
sudo chmod +x /opt/scripts/monitor.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œ
*/5 * * * * /opt/scripts/monitor.sh >> /var/log/monitor.log 2>&1
```

### 2ï¸âƒ£ å®‰å…¨ç®¡ç†

#### é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian (UFW)
sudo ufw enable
sudo ufw allow 22/tcp      # SSH
sudo ufw allow 80/tcp      # HTTP
sudo ufw allow 443/tcp     # HTTPS
sudo ufw allow 8080/tcp    # Tomcat
sudo ufw allow from 127.0.0.1 to any port 3306  # MySQL (ä»…æœ¬åœ°)
sudo ufw allow from 127.0.0.1 to any port 5244  # Alist (ä»…æœ¬åœ°)

# CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload
```

#### SSLè¯ä¹¦é…ç½®

```bash
# å®‰è£…Certbot
sudo apt install certbot  # Ubuntu/Debian
sudo yum install certbot  # CentOS/RHEL

# è·å–SSLè¯ä¹¦
sudo certbot certonly --standalone -d your-domain.com

# é…ç½®Tomcat SSL
sudo vim /opt/tomcat9/conf/server.xml
```

**SSLè¿æ¥å™¨é…ç½®**ï¼š

```xml
<Connector port="8443" protocol="org.apache.coyote.http11.Http11NioProtocol"
           maxThreads="150" SSLEnabled="true">
    <SSLHostConfig>
        <Certificate certificateKeyFile="/etc/letsencrypt/live/your-domain.com/privkey.pem"
                     certificateFile="/etc/letsencrypt/live/your-domain.com/cert.pem"
                     certificateChainFile="/etc/letsencrypt/live/your-domain.com/chain.pem" />
    </SSLHostConfig>
</Connector>
```

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. åº”ç”¨æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**ï¼šTomcatå¯åŠ¨å¤±è´¥æˆ–åº”ç”¨æ— æ³•è®¿é—®

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥Tomcatæ—¥å¿—
tail -f /opt/tomcat9/logs/catalina.out
tail -f /opt/tomcat9/logs/localhost.*.log

# 2. æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 8080

# 3. æ£€æŸ¥Javaè¿›ç¨‹
jps -l

# 4. æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
sudo /opt/tomcat9/bin/catalina.sh configtest
```

**å¸¸è§è§£å†³æ–¹æ¡ˆ**ï¼š

- æ£€æŸ¥JAVA_HOMEç¯å¢ƒå˜é‡
- ç¡®è®¤ç«¯å£æœªè¢«å ç”¨
- æ£€æŸ¥web.xmlè¯­æ³•é”™è¯¯
- éªŒè¯JARä¾èµ–æ˜¯å¦å®Œæ•´

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šåº”ç”¨æŠ¥æ•°æ®åº“è¿æ¥é”™è¯¯

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u filehost -p file_hosting_system

# 2. æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
sudo systemctl status mysql

# 3. æŸ¥çœ‹MySQLé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/mysql/error.log

# 4. æ£€æŸ¥è¿æ¥æ•°
mysql -u root -p -e "SHOW STATUS LIKE 'Threads_connected';"
```

**å¸¸è§è§£å†³æ–¹æ¡ˆ**ï¼š

- æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æƒé™
- ç¡®è®¤æ•°æ®åº“æœåŠ¡æ­£å¸¸è¿è¡Œ
- éªŒè¯è¿æ¥æ± é…ç½®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

#### 3. AlistæœåŠ¡å¼‚å¸¸

**ç—‡çŠ¶**ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥æˆ–Alist APIè°ƒç”¨é”™è¯¯

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥AlistæœåŠ¡çŠ¶æ€
sudo systemctl status alist

# 2. æŸ¥çœ‹Alistæ—¥å¿—
sudo journalctl -u alist -f

# 3. æµ‹è¯•Alist API
curl http://localhost:5244/api/public/settings

# 4. æ£€æŸ¥å­˜å‚¨é…ç½®
curl -H "Authorization: Bearer your_token" http://localhost:5244/api/admin/storage/list
```

**å¸¸è§è§£å†³æ–¹æ¡ˆ**ï¼š

- é‡å¯AlistæœåŠ¡
- æ£€æŸ¥å­˜å‚¨é…ç½®
- éªŒè¯API Token
- ç¡®è®¤ç½‘ç»œè¿æ¥

#### 4. æ–‡ä»¶ä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶**ï¼šæ–‡ä»¶ä¸Šä¼ æ—¶æŠ¥é”™æˆ–ä¸Šä¼ åæ— æ³•è®¿é—®

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥ä¸´æ—¶ç›®å½•æƒé™
ls -la /tmp/filehosting/

# 2. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# 3. æŸ¥çœ‹ä¸Šä¼ æ—¥å¿—
grep "upload" /opt/tomcat9/logs/filehosting.log

# 4. æµ‹è¯•æ–‡ä»¶æƒé™
touch /tmp/test && rm /tmp/test
```

**å¸¸è§è§£å†³æ–¹æ¡ˆ**ï¼š

- æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶
- ç¡®è®¤ä¸´æ—¶ç›®å½•æƒé™
- éªŒè¯ç£ç›˜ç©ºé—´
- æ£€æŸ¥æ–‡ä»¶ç±»å‹é™åˆ¶

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1ï¸âƒ£ JVMä¼˜åŒ–

#### å†…å­˜é…ç½®

```bash
# ç¼–è¾‘Tomcatå¯åŠ¨è„šæœ¬
sudo vim /opt/tomcat9/bin/setenv.sh
```

**JVMä¼˜åŒ–å‚æ•°**ï¼š

```bash
# å †å†…å­˜è®¾ç½®
export CATALINA_OPTS="$CATALINA_OPTS -Xms2g -Xmx4g"

# æ–°ç”Ÿä»£è®¾ç½®
export CATALINA_OPTS="$CATALINA_OPTS -XX:NewRatio=3 -XX:SurvivorRatio=8"

# åƒåœ¾å›æ”¶å™¨
export CATALINA_OPTS="$CATALINA_OPTS -XX:+UseG1GC -XX:MaxGCPauseMillis=200"

# GCæ—¥å¿—
export CATALINA_OPTS="$CATALINA_OPTS -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps"
export CATALINA_OPTS="$CATALINA_OPTS -Xloggc:/opt/tomcat9/logs/gc.log -XX:+UseGCLogFileRotation"
export CATALINA_OPTS="$CATALINA_OPTS -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=10M"

# å…¶ä»–ä¼˜åŒ–
export CATALINA_OPTS="$CATALINA_OPTS -XX:+HeapDumpOnOutOfMemoryError"
export CATALINA_OPTS="$CATALINA_OPTS -XX:HeapDumpPath=/opt/tomcat9/logs/"
export CATALINA_OPTS="$CATALINA_OPTS -Djava.awt.headless=true"
export CATALINA_OPTS="$CATALINA_OPTS -Dfile.encoding=UTF-8"
```

### 2ï¸âƒ£ æ•°æ®åº“ä¼˜åŒ–

#### ç´¢å¼•ä¼˜åŒ–

```sql
-- åˆ†ææ…¢æŸ¥è¯¢
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log ORDER BY start_time DESC LIMIT 10;

-- æ·»åŠ å¤åˆç´¢å¼•
CREATE INDEX idx_user_type_time ON media_files(user_id, file_type, uploaded_at);
CREATE INDEX idx_filename_user ON media_files(filename, user_id);

-- åˆ†æè¡¨
ANALYZE TABLE users, media_files, system_logs;

-- ä¼˜åŒ–è¡¨
OPTIMIZE TABLE users, media_files, system_logs;
```

#### æŸ¥è¯¢ä¼˜åŒ–

```sql
-- ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢
EXPLAIN SELECT * FROM media_files WHERE user_id = 1 ORDER BY uploaded_at DESC LIMIT 20;

-- ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢
SELECT * FROM media_files 
WHERE user_id = ? AND id > ? 
ORDER BY id 
LIMIT 20;

-- ä½¿ç”¨è¦†ç›–ç´¢å¼•
SELECT id, filename, file_size, uploaded_at 
FROM media_files 
WHERE user_id = ? 
ORDER BY uploaded_at DESC 
LIMIT 20;
```

### 3ï¸âƒ£ åº”ç”¨ä¼˜åŒ–

#### è¿æ¥æ± ä¼˜åŒ–

```properties
# C3P0è¿æ¥æ± ä¼˜åŒ–é…ç½®
c3p0.initialPoolSize=10
c3p0.maxPoolSize=50
c3p0.minPoolSize=5
c3p0.acquireIncrement=5
c3p0.maxIdleTime=3600
c3p0.checkoutTimeout=5000
c3p0.testConnectionOnCheckout=false
c3p0.testConnectionOnCheckin=true
c3p0.idleConnectionTestPeriod=300
c3p0.preferredTestQuery=SELECT 1
c3p0.maxStatementsPerConnection=20
```

#### ç¼“å­˜ç­–ç•¥

```java
// å®ç°ç®€å•çš„å†…å­˜ç¼“å­˜
public class FileCache {
    private static final Map<String, MediaFile> cache = new ConcurrentHashMap<>();
    private static final long CACHE_EXPIRE_TIME = 30 * 60 * 1000; // 30åˆ†é’Ÿ
    
    public static void put(String key, MediaFile file) {
        cache.put(key, file);
        // è®¾ç½®è¿‡æœŸæ—¶é—´
        Timer timer = new Timer();
        timer.schedule(new TimerTask() {
            @Override
            public void run() {
                cache.remove(key);
            }
        }, CACHE_EXPIRE_TIME);
    }
    
    public static MediaFile get(String key) {
        return cache.get(key);
    }
}
```

---

## ğŸ”— ç›¸å…³é¡µé¢

- [é¦–é¡µ](Wiki-Home.md) - é¡¹ç›®æ¦‚è¿°å’Œæ–‡æ¡£å¯¼èˆª
- [ç³»ç»Ÿæ¶æ„](Wiki-System-Architecture.md) - è¯¦ç»†çš„ç³»ç»Ÿæ¶æ„è®¾è®¡
- [APIæ–‡æ¡£](Wiki-API-Documentation.md) - ç³»ç»ŸAPIæ¥å£æ–‡æ¡£
- [é¡¹ç›®ç»“æ„](Wiki-Project-Structure.md) - é¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜
- [å¼€å‘æŒ‡å—](Wiki-Development-Guide.md) - å¼€å‘ç¯å¢ƒæ­å»ºå’Œå¼€å‘è§„èŒƒ

---

*æœ€åæ›´æ–°æ—¶é—´ï¼š2024å¹´*